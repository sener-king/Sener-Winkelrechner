<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sener Fl√§chenberechnung</title>
    <!-- Link zum Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Optional: Icon f√ºr iOS -->
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
            line-height: 1.6;
        }
        .container {
            max-width: 520px;
            margin: 20px auto;
            padding: 20px;
            background-color: #1e1e1e;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            color: #ffffff;
            font-size: 1.5em;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }
        .tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .tab-button {
            flex: 1;
            padding: 12px;
            margin: 0 5px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .tab-button.active {
            background-color: #28a745;
        }
        .tab-button:hover {
            background-color: #5a6268;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            background-color: #252525;
            padding: 16px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        }
        label {
            display: block;
            margin-top: 12px;
            font-weight: bold;
            color: #cccccc;
            font-size: 0.95em;
        }
        input[type="number"], select, input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-top: 6px;
            background-color: #333333;
            color: #ffffff;
            border: 1px solid #555555;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 14px;
            margin-top: 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover {
            background-color: #218838;
        }
        .button-secondary {
            background-color: #6c757d;
            margin-top: 10px;
        }
        .button-secondary:hover {
            background-color: #5a6268;
        }
        .result {
            margin-top: 25px;
            padding: 16px;
            background-color: #252525;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: none;
        }
        .result h3 {
            margin: 0 0 12px 0;
            color: #28a745;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .result-label {
            font-size: 0.95em;
            color: #aaaaaa;
        }
        .result-value-large {
            font-size: 2em;
            font-weight: bold;
            color: #ffffff;
        }
        .result-value-small {
            font-size: 0.9em;
            color: #ff5555;
        }
        .info {
            font-size: 0.85em;
            color: #888888;
            text-align: center;
            margin-top: 10px;
        }
        .icon {
            font-size: 1.2em;
        }

        /* ========== POPUP ========== */
        .popup {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: #1e1e1e;
            width: 95%;
            max-width: 520px;
            max-height: 90vh;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        .popup-header {
            padding: 16px;
            background: #28a745;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2em;
        }
        .popup-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        .history-list {
            padding: 0;
            margin: 0;
        }
        .history-item {
            padding: 14px 16px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1em;
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .history-info {
            flex: 1;
            cursor: pointer;
        }
        .history-info:hover {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 4px;
            margin: -4px;
        }
        .history-time {
            font-size: 0.85em;
            color: #aaa;
            margin-top: 4px;
        }
        .history-input {
            font-size: 0.9em;
            color: #888;
            margin-top: 2px;
        }
        .history-delete {
            background: none;
            border: none;
            color: #ff5555;
            font-size: 1.5em;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .history-delete:hover {
            background-color: #333;
        }
        .empty-history {
            padding: 30px;
            text-align: center;
            color: #888;
        }
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.8em;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
        }

        /* Neue Stile f√ºr Fl√§chenberechnung */
        .raum-liste {
            margin-top: 20px;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 6px;
        }
        .raum-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #252525;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .raum-name {
            font-weight: bold;
        }
        .raum-flaeche {
            font-weight: bold;
            color: #28a745;
        }
        .raum-actions {
            display: flex;
            gap: 5px;
        }
        .raum-delete {
            background: none;
            border: none;
            color: #ff5555;
            font-size: 1.2em;
            cursor: pointer;
        }
        .raum-delete:hover {
            background-color: #333;
        }
        .total-flaeche {
            margin-top: 20px;
            padding: 10px;
            background-color: #252525;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .total-label {
            font-size: 1.2em;
            font-weight: bold;
        }
        .total-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #28a745;
        }
        .print-button {
            margin-top: 10px;
            background-color: #007bff;
        }
        .print-button:hover {
            background-color: #0056b3;
        }
        .pdf-button {
            margin-top: 10px;
            background-color: #FF6600;
        }
        .pdf-button:hover {
            background-color: #e65c00;
        }
        .share-button {
            margin-top: 10px;
            background-color: #6c757d;
        }
        .share-button:hover {
            background-color: #5a6268;
        }
        .whatsapp-button {
            margin-top: 10px;
            background-color: #25D366;
        }
        .whatsapp-button:hover {
            background-color: #1da85f;
        }
        .speichern-button {
            margin-top: 10px;
            background-color: #28a745;
        }
        .speichern-button:hover {
            background-color: #218838;
        }
        .historie-button {
            margin-top: 10px;
            background-color: #6c757d;
        }
        .historie-button:hover {
            background-color: #5a6268;
        }
        .versenden-button {
            margin-top: 10px;
            background-color: #6c757d;
        }
        .versenden-button:hover {
            background-color: #5a6268;
        }
        .wohnung-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #252525;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .wohnung-name {
            font-weight: bold;
        }
        .wohnung-flaeche {
            font-weight: bold;
            color: #28a745;
        }
        .wohnung-actions {
            display: flex;
            gap: 5px;
        }
        .wohnung-delete {
            background: none;
            border: none;
            color: #ff5555;
            font-size: 1.2em;
            cursor: pointer;
        }
        .wohnung-delete:hover {
            background-color: #333;
        }
        .wohnung-send {
            background: none;
            border: none;
            color: #25D366;
            font-size: 1.2em;
            cursor: pointer;
        }
        .wohnung-send:hover {
            background-color: #1da85f;
        }
        /* Neues Popup f√ºr Aktionen */
        .aktionen-popup {
            display: none;
            position: fixed;
            bottom: 20px; /* Am unteren Rand positionieren */
            right: 20px;  /* Am rechten Rand positionieren */
            width: 200px;
            background-color: #252525;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            z-index: 1001;
            padding: 10px;
        }
        .aktionen-popup button {
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .aktionen-popup button:hover {
            background-color: #5a6268;
        }
        .aktionen-popup .print-button {
            background-color: #007bff;
        }
        .aktionen-popup .pdf-button {
            background-color: #FF6600;
        }
        .aktionen-popup .whatsapp-button {
            background-color: #25D366;
        }
        .aktionen-popup .share-button {
            background-color: #6c757d;
        }
        /* Kreis-Berechnung: Norm-Anzeige */
        .norm-anzeige {
            margin-top: 10px;
            padding: 10px;
            background-color: #2a2a2a;
            border-radius: 6px;
            font-size: 0.9em;
            color: #888;
        }
        .norm-anzeige strong {
            color: #ffffff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Sener Fl√§chenberechnung</h1>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-button active" onclick="zeigeTab('winkel')">Winkel</button>
        <button class="tab-button" onclick="zeigeTab('dreieck')">Dreieck</button>
        <button class="tab-button" onclick="zeigeTab('kreis')">Kreis</button>
        <button class="tab-button" onclick="zeigeTab('flaeche')">Fl√§che</button>
    </div>

    <!-- Tab Inhalt: Winkelberechnung -->
    <div id="winkel" class="tab-content active">
        <div class="section">
            <label for="istMasse">ü™ô Gemessene gesamt ma√üe in mm</label> <!-- Ge√§ndert -->
            <input type="number" id="istMasse" placeholder="z.B. 4500" value="" inputmode="numeric">

            <label for="bereich">üèóÔ∏è Bereich:</label>
            <select id="bereich">
                <option value="metallbau" selected>Metallbau (3-4-5) Berechnung</option>
                <option value="wohnungsbau">Wohnungsbau (mittel)</option>
                <option value="agrar">Landbau (genau)</option>
            </select>

            <button onclick="berechneMassen()">
                <span class="icon">üìê</span> Berechnen
            </button>
            <button onclick="zeige3erReihe()" class="button-secondary">
                <span class="icon">üßÆ</span> 3er-Reihe anzeigen
            </button>
            <button onclick="oeffneWinkelHistorie()" class="button-secondary">
                üïí Historie anzeigen
            </button>
            <p class="info">Metallbau: Max. A = 6900 mm, nie exakt passender Wert</p>
        </div>

        <div id="ergebnis" class="result">
            <h3><span class="icon">‚úÖ</span> Absteck-Ma√üe</h3>
            <div class="result-item">
                <div style="text-align: center;">
                    <div class="result-value-large" id="masseA">-</div>
                    <div style="font-size: 0.8em; color: #aaa;">Kathete A<br>(<span id="multiplier">?</span> √ó 3)</div>
                    <div class="result-value-small" id="masseA_m">-</div>
                </div>
            </div>
            <div class="result-item">
                <span class="result-label">Kathete B<br>(4er-Seite)</span>
                <span class="result-value-small" id="masseB">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Hypotenuse C<br>(5er-Seite)</span>
                <span class="result-value-small" id="masseC">-</span>
            </div>
        </div>
    </div>

    <!-- Tab Inhalt: Dreiecksberechnung -->
    <div id="dreieck" class="tab-content">
        <div class="section">
            <label for="seiteA">Seite A (mm):</label>
            <input type="number" id="seiteA" placeholder="z.B. 3000" value="" inputmode="numeric">

            <label for="seiteB">Seite B (mm):</label>
            <input type="number" id="seiteB" placeholder="z.B. 4000" value="" inputmode="numeric">

            <label for="winkelGamma">Winkel Œ≥ (Grad):</label>
            <input type="number" id="winkelGamma" placeholder="z.B. 90" value="" inputmode="numeric">

            <button onclick="berechneDreieck()">
                <span class="icon">üìê</span> Berechnen
            </button>
        </div>

        <div id="ergebnisDreieck" class="result">
            <h3><span class="icon">üìê</span> Dreiecks-Ergebnisse</h3>
            <div class="result-item">
                <span class="result-label">Seite C (mm)</span>
                <span class="result-value-small" id="seiteC">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Fl√§che (m¬≤)</span>
                <span class="result-value-small" id="flaecheDreieck">-</span>
            </div>
        </div>
    </div>

    <!-- Tab Inhalt: Kreisberechnung -->
    <div id="kreis" class="tab-content">
        <div class="section">
            <label for="durchmesser">Durchmesser (mm):</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="durchmesser" placeholder="z.B. 1000" value="" inputmode="numeric" oninput="updateNormAndCalculate()" />
                <select id="durchmesserEinheit" onchange="updateNormAndCalculate()">
                    <option value="mm">mm</option>
                    <option value="zoll">Zoll</option>
                </select>
            </div>

            <label for="rohrNorm">Rohr-Norm (NW / Zoll):</label>
            <select id="rohrNorm" onchange="updateDurchmesserFromNorm()">
                <option value="">-- Bitte w√§hlen --</option>
                <option value="6">6 (1/8")</option>
                <option value="8">8 (1/4")</option>
                <option value="10">10 (3/8")</option>
                <option value="15">15 (1/2")</option>
                <option value="20">20 (3/4")</option>
                <option value="25">25 (1")</option>
                <option value="32">32 (1 1/4")</option>
                <option value="40">40 (1 1/2")</option>
                <option value="50">50 (2")</option>
                <option value="65">65 (2 1/2")</option>
                <option value="80">80 (3")</option>
                <option value="90">90 (3 1/2")</option>
                <option value="100">100 (4")</option>
                <option value="125">125 (5")</option>
                <option value="150">150 (6")</option>
                <option value="175">175 (7")</option>
                <option value="200">200 (8")</option>
                <option value="250">250 (10")</option>
                <option value="300">300 (12")</option>
                <option value="350">350 (14")</option>
                <option value="400">400 (16")</option>
                <option value="450">450 (18")</option>
                <option value="500">500 (20")</option>
                <option value="600">600 (24")</option>
                <option value="700">700 (28")</option>
                <option value="800">800 (32")</option>
                <option value="900">900 (36")</option>
                <option value="1000">1000 (40")</option>
            </select>

            <div id="normAnzeige" class="norm-anzeige">
                <!-- Wird dynamisch gef√ºllt -->
                Keine Norm gefunden.
            </div>

            <button onclick="berechneKreis()" class="button-secondary">
                <span class="icon">‚≠ï</span> Berechnen (optional)
            </button>
        </div>

        <div id="ergebnisKreis" class="result">
            <h3><span class="icon">‚≠ï</span> Kreis-Ergebnisse</h3>
            <div class="result-item">
                <span class="result-label">Umfang (m)</span>
                <span class="result-value-small" id="umfangKreis">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Fl√§che (m¬≤)</span>
                <span class="result-value-small" id="flaecheKreis">-</span>
            </div>
        </div>
    </div>

    <!-- Tab Inhalt: Fl√§chenberechnung -->
    <div id="flaeche" class="tab-content">
        <div class="section">
            <label for="ueberschrift">Berechnung √úberschrift z.B. Wohnung, Lager, fl√§che</label>
            <input type="text" id="ueberschrift" placeholder="z.B. Wohnung 1" value="" />

            <label for="raumName">Raumname (z.B. Wohnzimmer):</label>
            <input type="text" id="raumName" placeholder="z.B. Wohnzimmer" value="" />

            <label for="laenge">L√§nge:</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="laenge" placeholder="z.B. 5" value="" inputmode="numeric" />
                <select id="laengeEinheit">
                    <option value="mm">mm</option>
                    <option value="cm">cm</option>
                    <option value="m" selected>m</option>
                </select>
            </div>

            <label for="breite">Breite:</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="breite" placeholder="z.B. 3" value="" inputmode="numeric" />
                <select id="breiteEinheit">
                    <option value="mm">mm</option>
                    <option value="cm">cm</option>
                    <option value="m" selected>m</option>
                </select>
            </div>

            <button onclick="berechneFlaeche()">
                <span class="icon">‚¨ú</span> Raum berechnen
            </button>

            <button onclick="speichereBerechnung()" class="speichern-button">
                <span class="icon">üíæ</span> Berechnung Speichern
            </button>

            <button onclick="oeffneFlaecheHistorie()" class="historie-button">
                <span class="icon">üìú</span> Historie
            </button>

            <button onclick="oeffneAktionenPopup()" class="versenden-button">
                <span class="icon">üì§</span> Versenden
            </button>

            <!-- Neues Popup f√ºr Aktionen -->
            <div id="aktionenPopup" class="aktionen-popup">
                <button class="print-button" onclick="druckeErgebnisse()">
                    <span class="icon">üñ®Ô∏è</span> Drucken
                </button>
                <button class="pdf-button" onclick="speichereAlsPDF()">
                    <span class="icon">üìÑ</span> Als PDF speichern
                </button>
                <button class="whatsapp-button" onclick="versendePerWhatsApp()">
                    <span class="icon">üí¨</span> Per WhatsApp versenden
                </button>
                <button class="share-button" onclick="versendeErgebnisse()">
                    <span class="icon">üìß</span> Per E-Mail versenden
                </button>
            </div>
        </div>

        <div id="ergebnisFlaeche" class="result">
            <h3><span class="icon">‚¨ú</span> Fl√§chen-Ergebnisse</h3>
            <div class="result-item">
                <span class="result-label">Gesamtfl√§che (m¬≤)</span>
                <span class="result-value-large" id="gesamtFlaeche">0.000</span>
            </div>
        </div>

        <div class="raum-liste">
            <h4>üìä Gespeicherte R√§ume</h4>
            <div id="raumListe">
                <!-- Wird dynamisch gef√ºllt -->
            </div>
        </div>

        <div class="total-flaeche">
            <span class="total-label">Gesamtfl√§che aller R√§ume:</span>
            <span class="total-value" id="totalFlaeche">0.000 m¬≤</span>
        </div>

        <button onclick="speichereGesamteWohnung()" class="speichern-button">
            <span class="icon">üè†</span> Gesamte Wohnung speichern
        </button>
    </div>
</div>

<!-- Popup f√ºr Winkel-Historie -->
<div id="winkelHistoriePopup" class="popup">
    <div class="popup-content">
        <div class="popup-header">
            <span>üü¢ Historie der Winkelberechnungen</span>
            <button class="close-btn" onclick="schliesseWinkelHistorie()">√ó</button>
        </div>
        <div class="popup-body">
            <div class="history-list" id="winkelHistoryListe">
                <!-- Wird dynamisch gef√ºllt -->
            </div>
        </div>
        <div style="padding: 16px; background: #1e1e1e; border-top: 1px solid #333;">
            <button onclick="zurueckZurWinkelBerechnung()" style="width:100%; padding:12px; background-color:#28a745; color:white; border:none; border-radius:6px; font-weight:bold; font-size:16px;">
                üîô Zur√ºck zur Berechnung
            </button>
        </div>
    </div>
</div>

<!-- Popup f√ºr 3er-Reihe -->
<div id="popup3er" class="popup">
    <div class="popup-content">
        <div class="popup-header">
            <span>üßÆ 3er-Multiplikatoren (n √ó 3)</span>
            <button class="close-btn" onclick="schliessePopup()">√ó</button>
        </div>
        <div class="popup-body">
            <div class="history-list" id="popupListe">
                <!-- Wird gef√ºllt -->
            </div>
        </div>
    </div>
</div>

<!-- Popup f√ºr Fl√§chen-Historie -->
<div id="flaecheHistoriePopup" class="popup">
    <div class="popup-content">
        <div class="popup-header">
            <span>üü£ Historie der gespeicherten Berechnungen</span>
            <button class="close-btn" onclick="schliesseFlaecheHistorie()">√ó</button>
        </div>
        <div class="popup-body">
            <div class="history-list" id="flaecheHistoryListe">
                <!-- Wird dynamisch gef√ºllt -->
            </div>
        </div>
        <div style="padding: 16px; background: #1e1e1e; border-top: 1px solid #333;">
            <button onclick="zurueckZurFlaeche()" style="width:100%; padding:12px; background-color:#28a745; color:white; border:none; border-radius:6px; font-weight:bold; font-size:16px;">
                üîô Zur√ºck zur Fl√§che
            </button>
        </div>
    </div>
</div>

<script>
let berechnungsHistorie = JSON.parse(localStorage.getItem('sener_historie')) || [];
let raumHistorie = JSON.parse(localStorage.getItem('sener_raum_historie')) || [];
let berechnungHistorie = JSON.parse(localStorage.getItem('sener_berechnung_historie')) || []; // <- BEHAALT (f√ºr Fl√§chen-Historie)

// --- ZENTRALE ROHR-NORMEN-TABELLE ---
const ROHR_NORMEN = {
    "6": { zoll: "1/8\"", iso: 10.2, ansi: 10.5 },
    "8": { zoll: "1/4\"", iso: 13.5, ansi: 13.72 },
    "10": { zoll: "3/8\"", iso: 17.2, ansi: 17.15 },
    "15": { zoll: "1/2\"", iso: 21.3, ansi: 21.34 },
    "20": { zoll: "3/4\"", iso: 26.9, ansi: 26.67 },
    "25": { zoll: "1\"", iso: 33.7, ansi: 33.40 },
    "32": { zoll: "1 1/4\"", iso: 42.4, ansi: 42.16 },
    "40": { zoll: "1 1/2\"", iso: 48.3, ansi: 48.26 },
    "50": { zoll: "2\"", iso: 60.3, ansi: 60.33 },
    "65": { zoll: "2 1/2\"", iso: 76.1, ansi: 73.03 },
    "80": { zoll: "3\"", iso: 88.9, ansi: 88.90 },
    "90": { zoll: "3 1/2\"", iso: 101.6, ansi: 101.60 },
    "100": { zoll: "4\"", iso: 114.3, ansi: 114.30 },
    "125": { zoll: "5\"", iso: 139.7, ansi: 141.30 },
    "150": { zoll: "6\"", iso: 168.3, ansi: 168.28 },
    "175": { zoll: "7\"", iso: 193.7, ansi: 193.70 },
    "200": { zoll: "8\"", iso: 219.1, ansi: 219.08 },
    "250": { zoll: "10\"", iso: 273.0, ansi: 273.05 },
    "300": { zoll: "12\"", iso: 323.9, ansi: 323.85 },
    "350": { zoll: "14\"", iso: 355.6, ansi: 355.60 },
    "400": { zoll: "16\"", iso: 406.4, ansi: 406.40 },
    "450": { zoll: "18\"", iso: 457.2, ansi: 457.20 },
    "500": { zoll: "20\"", iso: 508.0, ansi: 508.00 },
    "600": { zoll: "24\"", iso: 609.6, ansi: 609.60 },
    "700": { zoll: "28\"", iso: 711.2, ansi: 711.20 },
    "800": { zoll: "32\"", iso: 812.8, ansi: 812.80 },
    "900": { zoll: "36\"", iso: 914.4, ansi: 914.40 },
    "1000": { zoll: "40\"", iso: 1016.0, ansi: 1016.00 }
};

// Tab-Wechsel
function zeigeTab(tabName) {
    // Alle Tabs ausblenden
    const tabs = document.getElementsByClassName('tab-content');
    for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }

    // Alle Tab-Buttons inaktiv setzen
    const buttons = document.getElementsByClassName('tab-button');
    for (let i = 0; i < buttons.length; i++) {
        buttons[i].classList.remove('active');
    }

    // Angeklickten Tab einblenden
    document.getElementById(tabName).classList.add('active');
    // Angeklickten Button aktiv setzen
    event?.currentTarget?.classList.add('active');

    // Men√º schlie√üen, wenn auf anderen Tab gewechselt wird
    document.getElementById('aktionenPopup').style.display = 'none';
}

// --- BESTEHENDE WINKELBERECHNUNG ---
function berechneMassen() {
    const rawInput = document.getElementById('istMasse').value.replace(/,/g, '.').replace(/\s/g, '');
    const istMasse = parseFloat(rawInput);
    const bereich = document.getElementById('bereich').value;
    const ergebnisDiv = document.getElementById('ergebnis');

    if (isNaN(istMasse) || istMasse < 300) {
        alert("Bitte geben Sie eine g√ºltige Ist-Masse ‚â• 300 mm ein.");
        ergebnisDiv.style.display = 'none';
        return;
    }

    let masseA, masseB, masseC, multiplier;

    if (bereich === 'metallbau') {
        const aMax = Math.floor((istMasse - 1) / 300) * 300;
        masseA = aMax > 6900 ? 6900 : aMax;
        if (masseA < 300) {
            alert("Zu klein f√ºr Metallbau.");
            ergebnisDiv.style.display = 'none';
            return;
        }
        multiplier = masseA / 3;
        masseB = multiplier * 4;
        masseC = multiplier * 5;
    } else if (bereich === 'wohnungsbau') {
        const k = Math.floor(istMasse / 3 / 50) * 50;
        multiplier = k;
        masseA = k * 3;
        masseB = k * 4;
        masseC = k * 5;
    } else if (bereich === 'agrar') {
        const k = Math.floor(istMasse / 3 / 10) * 10;
        multiplier = k;
        masseA = k * 3;
        masseB = k * 4;
        masseC = k * 5;
    }

    document.getElementById('masseA').textContent = masseA.toLocaleString('de-DE');
    document.getElementById('masseA_m').textContent = (masseA / 1000).toFixed(3) + " m";
    document.getElementById('masseB').textContent = (masseB / 1000).toFixed(3) + " m";
    document.getElementById('masseC').textContent = (masseC / 1000).toFixed(3) + " m";
    document.getElementById('multiplier').textContent = multiplier.toLocaleString('de-DE');
    ergebnisDiv.style.display = 'block';

    const eintrag = {
        id: Date.now(),
        zeit: new Date().toLocaleString('de-DE'),
        input: istMasse,
        bereich: bereich,
        a: masseA,
        b: masseB,
        c: masseC,
        k: multiplier
    };

    berechnungsHistorie.unshift(eintrag);
    if (berechnungsHistorie.length > 20) berechnungsHistorie.pop();
    localStorage.setItem('sener_historie', JSON.stringify(berechnungsHistorie));
}

// --- DREIECKBERECHNUNG ---
function berechneDreieck() {
    const a = parseFloat(document.getElementById('seiteA').value);
    const b = parseFloat(document.getElementById('seiteB').value);
    const gammaGrad = parseFloat(document.getElementById('winkelGamma').value);

    if (isNaN(a) || isNaN(b) || isNaN(gammaGrad) || a <= 0 || b <= 0 || gammaGrad <= 0) {
        alert("Bitte geben Sie g√ºltige Werte f√ºr die Seiten und den Winkel ein.");
        return;
    }

    const gammaRad = gammaGrad * Math.PI / 180;
    // Cosinussatz: c¬≤ = a¬≤ + b¬≤ - 2ab*cos(gamma)
    const c = Math.sqrt(a*a + b*b - 2*a*b*Math.cos(gammaRad));
    // Fl√§che: A = 0.5 * a * b * sin(gamma)
    const flaeche = 0.5 * a * b * Math.sin(gammaRad);

    document.getElementById('seiteC').textContent = c.toFixed(2) + " mm";
    document.getElementById('flaecheDreieck').textContent = (flaeche / 1000000).toFixed(3) + " m¬≤";

    document.getElementById('ergebnisDreieck').style.display = 'block';
}

// --- KREISBERECHNUNG ---
function updateNormAndCalculate() {
    let d = parseFloat(document.getElementById('durchmesser').value);
    const einheit = document.getElementById('durchmesserEinheit').value;
    const rohrNormSelect = document.getElementById('rohrNorm');
    const normAnzeige = document.getElementById('normAnzeige');

    // Umrechnung in mm
    if (einheit === 'zoll') {
        d = d * 25.4; // 1 Zoll = 25.4 mm
    }

    // Finde die n√§chste Norm
    let naechsteNorm = null;
    let minAbstand = Infinity;

    for (const [nw, normData] of Object.entries(ROHR_NORMEN)) {
        const abstand = Math.abs(d - normData.iso);
        if (abstand < minAbstand) {
            minAbstand = abstand;
            naechsteNorm = { nw, ...normData };
        }
    }

    if (naechsteNorm) {
        rohrNormSelect.value = naechsteNorm.nw;
        normAnzeige.innerHTML = `
            <strong>N√§chste Norm:</strong> ${naechsteNorm.nw} (${naechsteNorm.zoll})<br>
            <strong>ISO:</strong> ${naechsteNorm.iso} mm<br>
            <strong>ANSI:</strong> ${naechsteNorm.ansi} mm
        `;
    } else {
        rohrNormSelect.value = "";
        normAnzeige.innerHTML = "Keine Norm gefunden.";
    }

    // Automatische Berechnung
    berechneKreis();
}

function updateDurchmesserFromNorm() {
    const rohrNorm = document.getElementById('rohrNorm').value;
    const durchmesserInput = document.getElementById('durchmesser');
    const normAnzeige = document.getElementById('normAnzeige');

    if (rohrNorm === "") {
        durchmesserInput.value = "";
        normAnzeige.innerHTML = "Keine Norm ausgew√§hlt.";
        berechneKreis(); // Setze Ergebnisse zur√ºck
        return;
    }

    const norm = ROHR_NORMEN[rohrNorm];
    if (norm) {
        durchmesserInput.value = norm.iso;
        normAnzeige.innerHTML = `
            <strong>Norm:</strong> ${rohrNorm} (${norm.zoll})<br>
            <strong>ISO:</strong> ${norm.iso} mm<br>
            <strong>ANSI:</strong> ${norm.ansi} mm
        `;
    } else {
        normAnzeige.innerHTML = "Norm nicht gefunden.";
    }

    // Automatische Berechnung
    berechneKreis();
}

function berechneKreis() {
    let d = parseFloat(document.getElementById('durchmesser').value);
    const einheit = document.getElementById('durchmesserEinheit').value;

    if (isNaN(d) || d <= 0) {
        document.getElementById('umfangKreis').textContent = "-";
        document.getElementById('flaecheKreis').textContent = "-";
        return;
    }

    // Umrechnung in mm
    if (einheit === 'zoll') {
        d = d * 25.4; // 1 Zoll = 25.4 mm
    }

    const r = d / 2;
    const umfang = Math.PI * d;
    const flaeche = Math.PI * r * r;

    document.getElementById('umfangKreis').textContent = (umfang / 1000).toFixed(3) + " m";
    document.getElementById('flaecheKreis').textContent = (flaeche / 1000000).toFixed(3) + " m¬≤";
}

// --- FLAECHENBERECHNUNG ---
function berechneFlaeche() {
    const raumName = document.getElementById('raumName').value.trim();
    const l = parseFloat(document.getElementById('laenge').value);
    const b = parseFloat(document.getElementById('breite').value);
    const laengeEinheit = document.getElementById('laengeEinheit').value;
    const breiteEinheit = document.getElementById('breiteEinheit').value;

    if (!raumName || isNaN(l) || isNaN(b) || l <= 0 || b <= 0) {
        alert("Bitte geben Sie einen Raumnamen und g√ºltige L√§nge und Breite ein.");
        return;
    }

    // Umrechnung in Meter
    const faktorLaenge = laengeEinheit === 'mm' ? 0.001 : laengeEinheit === 'cm' ? 0.01 : 1;
    const faktorBreite = breiteEinheit === 'mm' ? 0.001 : breiteEinheit === 'cm' ? 0.01 : 1;

    const lInMeter = l * faktorLaenge;
    const bInMeter = b * faktorBreite;
    const flaeche = lInMeter * bInMeter;

    const raum = {
        id: Date.now(),
        name: raumName,
        laenge: l,
        breite: b,
        laengeEinheit: laengeEinheit,
        breiteEinheit: breiteEinheit,
        flaeche: flaeche,
        datum: new Date().toLocaleString('de-DE')
    };

    raumHistorie.unshift(raum);
    if (raumHistorie.length > 20) raumHistorie.pop();
    localStorage.setItem('sener_raum_historie', JSON.stringify(raumHistorie));

    zeigeRaumListe();
    berechneGesamtFlaeche();
}

function speichereBerechnung() {
    const berechnungName = document.getElementById('ueberschrift').value.trim();
    if (!berechnungName) {
        alert("Bitte geben Sie einen Namen f√ºr die Berechnung ein.");
        return;
    }

    if (raumHistorie.length === 0) {
        alert("Sie m√ºssen mindestens einen Raum hinzugef√ºgt haben, bevor Sie die Berechnung speichern k√∂nnen.");
        return;
    }

    const gesamtflaeche = raumHistorie.reduce((sum, r) => sum + r.flaeche, 0);

    const berechnung = {
        id: Date.now(),
        name: berechnungName,
        raeume: [...raumHistorie], // Kopie der aktuellen R√§ume
        gesamtflaeche: gesamtflaeche,
        datum: new Date().toLocaleString('de-DE')
    };

    berechnungHistorie.unshift(berechnung);
    if (berechnungHistorie.length > 20) berechnungHistorie.pop();
    localStorage.setItem('sener_berechnung_historie', JSON.stringify(berechnungHistorie));

    alert(`Berechnung "${berechnungName}" wurde erfolgreich gespeichert.`);
}

function speichereGesamteWohnung() {
    const wohnungName = document.getElementById('ueberschrift').value.trim();
    if (!wohnungName) {
        alert("Bitte geben Sie einen Namen f√ºr die Wohnung ein.");
        return;
    }

    if (raumHistorie.length === 0) {
        alert("Sie m√ºssen mindestens einen Raum hinzugef√ºgt haben, bevor Sie die Wohnung speichern k√∂nnen.");
        return;
    }

    const gesamtflaeche = raumHistorie.reduce((sum, r) => sum + r.flaeche, 0);

    const wohnung = {
        id: Date.now(),
        name: wohnungName,
        raeume: [...raumHistorie], // Kopie der aktuellen R√§ume
        gesamtflaeche: gesamtflaeche,
        datum: new Date().toLocaleString('de-DE')
    };

    berechnungHistorie.unshift(wohnung); // Speichert in berechnungHistorie (wie gew√ºnscht)
    if (berechnungHistorie.length > 20) berechnungHistorie.pop();
    localStorage.setItem('sener_berechnung_historie', JSON.stringify(berechnungHistorie));

    alert(`Wohnung "${wohnungName}" wurde erfolgreich gespeichert.`);
}

function zeigeRaumListe() {
    const liste = document.getElementById('raumListe');
    if (raumHistorie.length === 0) {
        liste.innerHTML = '<div class="empty-history">Noch keine R√§ume gespeichert.</div>';
        return;
    }

    liste.innerHTML = '';
    raumHistorie.forEach(raum => {
        const div = document.createElement('div');
        div.className = 'raum-item';
        div.innerHTML = `
            <div class="raum-name">${raum.name}</div>
            <div class="raum-flaeche">${raum.flaeche.toLocaleString('de-DE')} m¬≤</div>
            <div class="raum-actions">
                <button class="raum-delete" onclick="loescheRaum(${raum.id})">üóëÔ∏è</button>
            </div>
        `;
        liste.appendChild(div);
    });
}

function loescheRaum(id) {
    raumHistorie = raumHistorie.filter(r => r.id !== id);
    localStorage.setItem('sener_raum_historie', JSON.stringify(raumHistorie));
    zeigeRaumListe();
    berechneGesamtFlaeche();
}

function berechneGesamtFlaeche() {
    const gesamt = raumHistorie.reduce((sum, r) => sum + r.flaeche, 0);
    document.getElementById('gesamtFlaeche').textContent = gesamt.toLocaleString('de-DE');
    document.getElementById('totalFlaeche').textContent = gesamt.toLocaleString('de-DE') + " m¬≤";
}

// --- VERSAND-FUNKTIONEN ---
function druckeErgebnisse() {
    const printWindow = window.open('', '_blank');
    printWindow.document.write('<html><head><title>Fl√§chenberechnung</title></head><body>');
    printWindow.document.write('<h2>Fl√§chenberechnung</h2>');
    printWindow.document.write('<table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse;">');
    printWindow.document.write('<tr><th>Raum</th><th>L√§nge</th><th>Breite</th><th>Fl√§che (m¬≤)</th></tr>');
    raumHistorie.forEach(raum => {
        printWindow.document.write(`<tr><td>${raum.name}</td><td>${raum.laenge} ${raum.laengeEinheit}</td><td>${raum.breite} ${raum.breiteEinheit}</td><td>${raum.flaeche.toLocaleString('de-DE')}</td></tr>`);
    });
    printWindow.document.write('</table>');
    printWindow.document.write(`<p><strong>Gesamtfl√§che: ${raumHistorie.reduce((sum, r) => sum + r.flaeche, 0).toLocaleString('de-DE')} m¬≤</strong></p>`);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
}

let isPdfLibLoaded = false; // Variable, um den Ladezustand zu merken

function speichereAlsPDF() {
    const erstellePDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        let y = 20;
        doc.setFontSize(16);
        doc.text('Fl√§chenberechnung', 10, y);
        y += 10;

        doc.setFontSize(12);
        doc.text('Datum: ' + new Date().toLocaleString('de-DE'), 10, y);
        y += 10;

        doc.text('Raumname', 10, y);
        doc.text('L√§nge', 80, y);
        doc.text('Breite', 110, y);
        doc.text('Fl√§che (m¬≤)', 150, y);
        y += 10;

        doc.setDrawColor(0);
        doc.line(10, y - 5, 200, y - 5);

        raumHistorie.forEach(raum => {
            doc.text(raum.name, 10, y);
            doc.text(raum.laenge + ' ' + raum.laengeEinheit, 80, y);
            doc.text(raum.breite + ' ' + raum.breiteEinheit, 110, y);
            doc.text(raum.flaeche.toLocaleString('de-DE'), 150, y);
            y += 10;
            if (y > 280) { // Neue Seite, wenn unten angekommen
                doc.addPage();
                y = 20;
            }
        });

        y += 10;
        doc.setFontSize(14);
        doc.text('Gesamtfl√§che: ' + raumHistorie.reduce((sum, r) => sum + r.flaeche, 0).toLocaleString('de-DE') + ' m¬≤', 10, y);

        doc.save('Flaechenberechnung.pdf');
    };

    if (isPdfLibLoaded) {
        // Bibliothek ist schon geladen, direkt ausf√ºhren
        erstellePDF();
    } else {
        // Bibliothek laden
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = () => {
            isPdfLibLoaded = true; // Merken, dass sie geladen ist
            erstellePDF(); // Jetzt ausf√ºhren
        };
        script.onerror = () => {
            alert('Fehler beim Laden der PDF-Bibliothek. Bitte pr√ºfen Sie Ihre Internetverbindung.');
        };
        document.head.appendChild(script);
    }
}

function versendeErgebnisse() {
    const mailtoLink = 'mailto:?subject=Fl√§chenberechnung&body=';
    let body = 'Fl√§chenberechnung:
';
    raumHistorie.forEach(raum => {
        body += `${raum.name}: ${raum.laenge} ${raum.laengeEinheit} x ${raum.breite} ${raum.breiteEinheit} = ${raum.flaeche.toLocaleString('de-DE')} m¬≤
`;
    });
    body += `
Gesamtfl√§che: ${raumHistorie.reduce((sum, r) => sum + r.flaeche, 0).toLocaleString('de-DE')} m¬≤`;
    window.location.href = mailtoLink + encodeURIComponent(body);
}

function versendePerWhatsApp() {
    let message = 'Fl√§chenberechnung:
';
    raumHistorie.forEach(raum => {
        message += `${raum.name}: ${raum.laenge} ${raum.laengeEinheit} x ${raum.breite} ${raum.breiteEinheit} = ${raum.flaeche.toLocaleString('de-DE')} m¬≤
`;
    });
    message += `
Gesamtfl√§che: ${raumHistorie.reduce((sum, r) => sum + r.flaeche, 0).toLocaleString('de-DE')} m¬≤`;

    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

// --- AKTIONEN-MEN√ú (Popup) ---
function oeffneAktionenPopup() {
    const popup = document.getElementById('aktionenPopup');
    if (popup.style.display === 'block') {
        popup.style.display = 'none'; // Popup schlie√üen, wenn es offen ist
    } else {
        popup.style.display = 'block'; // Popup √∂ffnen, wenn es geschlossen ist
    }
}

// --- HISTORIE-FUNKTIONEN ---
function oeffneWinkelHistorie() {
    zeigeWinkelHistorieImPopup();
    document.getElementById('winkelHistoriePopup').style.display = 'flex';
}

function zeigeWinkelHistorieImPopup() {
    const liste = document.getElementById('winkelHistoryListe');
    if (berechnungsHistorie.length === 0) {
        liste.innerHTML = '<div class="empty-history">Noch keine Winkelberechnungen gespeichert.</div>';
        return;
    }

    liste.innerHTML = '';
    berechnungsHistorie.forEach(eintrag => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
            <div class="history-info" onclick="ladeWertAusWinkelHistorie(${eintrag.id})">
                <div><strong>${eintrag.a.toLocaleString('de-DE')} mm</strong> (${eintrag.bereich})</div>
                <div class="history-time">${eintrag.zeit}</div>
                <div class="history-input">Eingabe: ${eintrag.input} mm</div>
            </div>
            <button class="history-delete" onclick="loescheEintrag(${eintrag.id}, event)">üóëÔ∏è</button>
        `;
        liste.appendChild(div);
    });
}

function ladeWertAusWinkelHistorie(id) {
    const eintrag = berechnungsHistorie.find(e => e.id === id);
    if (eintrag) {
        document.getElementById('istMasse').value = eintrag.input;
        document.getElementById('bereich').value = eintrag.bereich;
        // Stelle sicher, dass der Winkel-Tab aktiv ist
        zeigeTab('winkel');
        setTimeout(berechneMassen, 300);
    }
}

function loescheEintrag(id, event) {
    if (event) event.stopPropagation();
    berechnungsHistorie = berechnungsHistorie.filter(e => e.id !== id);
    localStorage.setItem('sener_historie', JSON.stringify(berechnungsHistorie));
    zeigeWinkelHistorieImPopup();
}

function schliesseWinkelHistorie() {
    document.getElementById('winkelHistoriePopup').style.display = 'none';
}

function zurueckZurWinkelBerechnung() {
    schliesseWinkelHistorie();
    setTimeout(() => {
        zeigeTab('winkel');
    }, 300);
}

function oeffneFlaecheHistorie() {
    zeigeFlaecheHistorieImPopup();
    document.getElementById('flaecheHistoriePopup').style.display = 'flex';
}

function zeigeFlaecheHistorieImPopup() {
    const liste = document.getElementById('flaecheHistoryListe');
    if (berechnungHistorie.length === 0) {
        liste.innerHTML = '<div class="empty-history">Noch keine Berechnungen gespeichert.</div>';
        return;
    }

    liste.innerHTML = '';
    berechnungHistorie.forEach(berechnung => {
        const div = document.createElement('div');
        div.className = 'wohnung-item';
        div.innerHTML = `
            <div class="wohnung-name">${berechnung.name}</div>
            <div class="wohnung-flaeche">${berechnung.gesamtflaeche.toLocaleString('de-DE')} m¬≤</div>
            <div class="wohnung-actions">
                <button class="wohnung-delete" onclick="loescheBerechnung(${berechnung.id}, event)">üóëÔ∏è</button>
                <button class="wohnung-send" onclick="versendeBerechnung(${berechnung.id}, event)">üí¨</button>
            </div>
        `;
        liste.appendChild(div);
    });
}

function loescheBerechnung(id, event) {
    event.stopPropagation();
    if (!confirm("Sind Sie sicher, dass Sie diese Berechnung l√∂schen m√∂chten?")) return;

    berechnungHistorie = berechnungHistorie.filter(w => w.id !== id);
    localStorage.setItem('sener_berechnung_historie', JSON.stringify(berechnungHistorie));
    zeigeFlaecheHistorieImPopup();
}

function versendeBerechnung(id, event) {
    event.stopPropagation();
    const berechnung = berechnungHistorie.find(w => w.id === id);
    if (!berechnung) return;

    let message = `Berechnung: ${berechnung.name}
`;
    message += `Datum: ${berechnung.datum}
`;
    berechnung.raeume.forEach(raum => {
        message += `${raum.name}: ${raum.laenge} ${raum.laengeEinheit} x ${raum.breite} ${raum.breiteEinheit} = ${raum.flaeche.toLocaleString('de-DE')} m¬≤
`;
    });
    const gesamtflaeche = berechnung.raeume.reduce((sum, r) => sum + r.flaeche, 0);
    message += `
Gesamtfl√§che: ${gesamtflaeche.toLocaleString('de-DE')} m¬≤`;

    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

// --- NEUE FUNKTION: BERECHNUNG AUS HISTORIE LADEN ---
function ladeBerechnungAusHistorie(id, event) {
    event.stopPropagation(); // Verhindert, dass der Klick auf das Item die Aktionen √∂ffnet
    const berechnung = berechnungHistorie.find(w => w.id === id);
    if (!berechnung) return;

    // Raumhistorie mit den gespeicherten R√§umen ersetzen
    raumHistorie = [...berechnung.raeume];
    localStorage.setItem('sener_raum_historie', JSON.stringify(raumHistorie));

    // Optional: √úberschrift laden
    document.getElementById('ueberschrift').value = berechnung.name;

    // Anzeige aktualisieren
    zeigeRaumListe();
    berechneGesamtFlaeche();

    // Popup schlie√üen
    schliesseFlaecheHistorie();

    // Optional: Zum Fl√§chen-Tab wechseln
    setTimeout(() => {
        zeigeTab('flaeche');
    }, 300);

    alert(`Berechnung "${berechnung.name}" wurde geladen.`);
}

function schliesseFlaecheHistorie() {
    document.getElementById('flaecheHistoriePopup').style.display = 'none';
}

function zurueckZurFlaeche() {
    schliesseFlaecheHistorie();
    setTimeout(() => {
        zeigeTab('flaeche');
    }, 300);
}

// ===== 3er-Reihe =====
function zeige3erReihe() {
    const liste = document.getElementById('popupListe');
    liste.innerHTML = '';
    for (let n = 1; n <= 2300; n++) {
        const wert = n * 3;
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<div>${n.toLocaleString('de-DE')} √ó 3 = ${wert.toLocaleString('de-DE')} mm</div>`;
        liste.appendChild(div);
    }
    document.getElementById('popup3er').style.display = 'flex';
}

function schliessePopup() {
    document.getElementById('popup3er').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', () => {
    berechnungsHistorie = JSON.parse(localStorage.getItem('sener_historie')) || [];
    raumHistorie = JSON.parse(localStorage.getItem('sener_raum_historie')) || [];
    berechnungHistorie = JSON.parse(localStorage.getItem('sener_berechnung_historie')) || []; // <- BEHAALT
    zeigeRaumListe();
    berechneGesamtFlaeche();
});

// Service Worker registrieren
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js') // Achten Sie auf den korrekten Pfad
      .then(registration => {
        console.log('SW registriert: ', registration);
      })
      .catch(error => {
        console.log('SW Registrierung fehlgeschlagen: ', error);
      });
  });
}
</script>

</body>
</html>
